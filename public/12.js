webpackJsonp([12],{678:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=u(a(0)),o=u(a(146)),s=a(6),i=a(106),c=a(105),l=a(172);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={image:"",success:!1,errors:null,description:"",imagenCodificada:null},a.handleChange=a.handleChange.bind(a),a.chooseImageSource=a.chooseImageSource.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleSuccessfulUpload=a.handleSuccessfulUpload.bind(a),a.handleErrorOnUpload=a.handleErrorOnUpload.bind(a),a.registrarPublicacion=a.registrarPublicacion.bind(a),a.volverALaPaginaDelShow=a.volverALaPaginaDelShow.bind(a),a.revelarImagen=a.revelarImagen.bind(a),a.transferId=1,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Component),n(t,[{key:"handleChange",value:function(e){var t,a,n;this.setState((t={},a=e.target.name,n=e.target.value,a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t))}},{key:"chooseImageSource",value:function(e){var t=this;Cordova.exec(function(e){if(0!==e){var a=2===e?navigator.camera.PictureSourceType.PHOTOLIBRARY:navigator.camera.PictureSourceType.CAMERA;navigator.camera.getPicture(function(e){window.resolveLocalFileSystemURL(e,function(e){t.setState({image:e.toInternalURL()})},console.log)},console.log,{sourceType:a,allowEdit:!0,madiaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:!0})}},null,"Notification","confirm",["¿De donde desea tomar la imagen?","Buscar Foto",["Tomar Foto","Galería"]])}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var a=this.state,n=a.image,r=a.description,o=this.props,s=o.eventId,c=o.accessToken;this.setState({success:!1,errors:null}),this.props.appStartedLoading(),""!==n?Cordova.exec(this.handleSuccessfulUpload,this.handleErrorOnUpload,"FileTransfer","upload",[n,"https://app.oneshow.com.ar/api/event/"+s+"/rss","image",n.substr(n.lastIndexOf("/")+1),"",{description:r},!1,!1,{Authorization:"Bearer "+c,"X-Requested-With":"XMLHttpRequest"},this.transferId,"POST"]):i.request.post("/api/event/"+s+"/rss",{description:r},{headers:{Authorization:"Bearer "+c}}).then(function(e){return t.handleSuccessfulUpload({response:JSON.stringify(e.data),responseCode:e.status})}).catch(function(e){return t.handleErrorOnUpload({http_status:e.response.status,body:JSON.stringify(e.response.data)})})}},{key:"handleSuccessfulUpload",value:function(e){var t=this;console.log("res",e),e.responseCode&&(this.setState({description:"",image:"",success:!0,errors:null},function(){return t.props.appFinishLoading()}),this.transferId+=1)}},{key:"handleErrorOnUpload",value:function(e){if(console.log("err",e),422===e.http_status){var t=JSON.parse(e.body),a=[];Object.keys(t.errors).forEach(function(e){a=a.concat(t.errors[e])}),this.setState({success:!1,errors:a})}else this.setState({success:!1,errors:"Algo ha ocurrido, intentalo nuevamente."});this.props.appFinishLoading()}},{key:"revelarImagen",value:function(e){this.setState({imagenCodificada:e},function(){return document.getElementById("imagenCapturada").src="data:image/png;base64,"+e})}},{key:"registrarPublicacion",value:function(){var e=this;if(document.getElementById("descripcion").value){this.setState({estaCargando:!0});var t=new FormData;t.append("eventoId",this.props.eventId),t.append("descripcion",document.getElementById("descripcion").value),t.append("rutaDeImagen",this.state.imagenCodificada?this.state.imagenCodificada:null),i.request.post("api/event/RSS",t,{headers:{Authorization:"Bearer "+this.props.accessToken}}).then(function(){(0,o.default)("Éxito","Publicación enviada","success","sweet"),e.volverALaPaginaDelShow()})}else(0,o.default)("Sin información","Ingresa un estado a compartir","warning","sweet")}},{key:"volverALaPaginaDelShow",value:function(){this.props.setCurrentPage("Show"),this.props.history.push("/show")}},{key:"render",value:function(){return r.default.createElement("div",{className:"container-fluid"},""!==this.state.image&&r.default.createElement("div",{className:"row"},r.default.createElement("div",{className:"col"},r.default.createElement("img",{src:this.state.image,className:"img-fluid"}))),this.state.success&&r.default.createElement("div",{className:"alert alert-success"},"Publicación realizada correctamente"),null!==this.state.errors&&r.default.createElement("div",{className:"alert alert-danger"},"string"==typeof this.state.errors?this.state.errors:r.default.createElement("ul",{style:{margin:0,paddingInlineStart:"20px"}},this.state.errors.map(function(e,t){return r.default.createElement("li",{key:t},e)}))),r.default.createElement("div",null,r.default.createElement("div",{className:"row"},r.default.createElement("div",{className:"col"},r.default.createElement("div",{className:"form-group"},r.default.createElement("textarea",{rows:"3",name:"description",className:"form-control",onChange:this.handleChange,value:this.state.description,placeholder:"¿Qué estas pensando?",style:{marginTop:"0.5rem",color:"#000 !important",backgroundColor:"#fff !important"}})))),r.default.createElement("div",{className:"row"},r.default.createElement("div",{className:"col-1"},r.default.createElement("button",{type:"button",className:"btn btn-rojo btn-box-index",onClick:this.chooseImageSource},r.default.createElement("i",{className:"fas fa-camera fa-lg"}))),r.default.createElement("div",{className:"col-6 offset-3"},r.default.createElement("button",{type:"button",className:"btn btn-rojo btn-box-index",onClick:this.handleSubmit},"Publicar")))))}}]),t}();t.default=(0,s.connect)(function(e){return{current:e.navigation.current,eventId:e.events.current._id,accessToken:e.auth.accessToken}},function(e){return{setCurrentPage:function(t){return e((0,l.setCurrentPage)(t))},appStartedLoading:function(){return e((0,c.appStartedLoading)())},appFinishLoading:function(){return e((0,c.appFinishLoading)())}}})(d)}});